<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu | Urban Crave</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --gold: #D4AF37; --bg: #050505; --card: #141414; --text: #eee; }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 90px; }

        /* Navbar */
        nav { padding: 15px; background: #111; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .search-box { display: flex; align-items: center; background: #222; border-radius: 8px; padding: 10px; border: 1px solid #333; }
        .search-box input { background: transparent; border: none; color: white; flex: 1; outline: none; margin-left: 10px; }
        .search-box i { color: #666; }

        /* Filters */
        .filters { display: flex; gap: 10px; overflow-x: auto; padding: 15px; scrollbar-width: none; }
        .chip { padding: 8px 15px; background: #1a1a1a; border-radius: 20px; font-size: 13px; white-space: nowrap; border: 1px solid #333; color: #aaa; transition: 0.3s; cursor: pointer; }
        .chip.active { background: var(--gold); color: black; border-color: var(--gold); font-weight: bold; }

        /* Grid */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); /* Mobile fix: 2 items per row */
            gap: 12px; 
            padding: 0 12px; 
        }
        .card { background: var(--card); border-radius: 10px; overflow: hidden; border: 1px solid #222; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 130px; object-fit: cover; }
        .card-body { padding: 10px; display: flex; flex-direction: column; flex: 1; }
        .card h4 { font-size: 14px; margin-bottom: 5px; line-height: 1.2; }
        .card p { font-size: 10px; color: #888; margin-bottom: 10px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .price-row { margin-top: auto; display: flex; justify-content: space-between; align-items: center; }
        .add-btn { background: #222; color: var(--gold); border: 1px solid var(--gold); padding: 5px 12px; border-radius: 5px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .add-btn:active { background: var(--gold); color: black; }

        /* Cart Drawer */
        .cart-drawer { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; background: #111; z-index: 2000; border-left: 1px solid #333; padding: 20px; transition: 0.3s; display: flex; flex-direction: column; }
        .cart-drawer.open { right: 0; }
        .cart-items { flex: 1; overflow-y: auto; margin-top: 20px; }
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .checkout-btn { width: 100%; background: #25D366; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; border-top: 1px solid #333; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; padding-bottom: max(12px, env(safe-area-inset-bottom)); }
        .nav-btn { color: #666; text-align: center; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; text-decoration: none; width: 25%; }
        .nav-btn i { font-size: 20px; }
        .nav-btn.active { color: var(--gold); }
        .cart-badge { background: red; color: white; border-radius: 50%; padding: 2px 5px; font-size: 9px; position: absolute; top: -5px; right: -5px; }
    </style>
</head>
<body>

    <nav>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchBox" placeholder="Search dishes..." onkeyup="searchMenu()">
        </div>
    </nav>

    <div class="filters">
        <div class="chip active" onclick="filter('All', this)">All</div>
        <div class="chip" onclick="filter('Starters', this)">Starters</div>
        <div class="chip" onclick="filter('Main Course', this)">Main Course</div>
        <div class="chip" onclick="filter('Drinks', this)">Drinks</div>
        <div class="chip" onclick="filter('Dessert', this)">Dessert</div>
    </div>

    <div class="grid" id="grid">
        <p style="color:#666; padding:20px; grid-column:span 2; text-align:center;">Loading Menu...</p>
    </div>

    <div class="cart-drawer" id="cartDrawer">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Cart</h2>
            <i class="fas fa-times" onclick="toggleCart()" style="cursor:pointer; font-size: 20px;"></i>
        </div>
        <div class="cart-items" id="cartList">Cart is empty</div>
        <div style="border-top:1px solid #333; padding-top:15px;">
            <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:bold; margin-bottom:10px;">
                <span>Total</span>
                <span id="cartTotal">₹0</span>
            </div>
            <button class="checkout-btn" onclick="checkout()"><i class="fab fa-whatsapp"></i> Order on WhatsApp</button>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="index.html" class="nav-btn">
            <i class="fas fa-home"></i> Home
        </a>
        <a href="menu.html" class="nav-btn active">
            <i class="fas fa-book-open"></i> Menu
        </a>
        <a href="tel:+916377390984" class="nav-btn">
            <i class="fas fa-phone-alt"></i> Call
        </a>
        <div class="nav-btn" onclick="toggleCart()" style="cursor:pointer; position:relative;">
            <i class="fas fa-shopping-bag"></i> Cart
            <span class="cart-badge" id="navCartCount" style="display:none">0</span>
        </div>
    </div>

<script>
    const API_URL = '/.netlify/functions/api';
    let products = [];
    let cart = JSON.parse(localStorage.getItem('urbanCart')) || [];

    window.onload = async () => {
        try {
            const res = await fetch(API_URL);
            products = await res.json();
            
            // Check URL param for category
            const urlParams = new URLSearchParams(window.location.search);
            const cat = urlParams.get('cat');
            if(cat) {
                const chips = document.querySelectorAll('.chip');
                chips.forEach(c => {
                    if(c.innerText === cat) filter(cat, c);
                });
            } else {
                render(products);
            }
            updateCartUI();
        } catch(e) { document.getElementById('grid').innerHTML = "Failed to load."; }
    };

    function render(list) {
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        list.forEach(p => {
            grid.innerHTML += `
            <div class="card">
                <img src="${p.image_url}" onerror="this.src='https://via.placeholder.com/200'">
                <div class="card-body">
                    <h4>${p.name}</h4>
                    <p>${p.description}</p>
                    <div class="price-row">
                        <span style="color:var(--gold); font-weight:bold;">₹${p.price}</span>
                        <button class="add-btn" onclick="addToCart(${p.id})">ADD</button>
                    </div>
                </div>
            </div>`;
        });
    }

    function filter(cat, btn) {
        document.querySelectorAll('.chip').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        if(cat === 'All') render(products);
        else render(products.filter(p => p.category === cat));
    }

    function searchMenu() {
        const q = document.getElementById('searchBox').value.toLowerCase();
        render(products.filter(p => p.name.toLowerCase().includes(q)));
    }

    function addToCart(id) {
        const p = products.find(x => x.id === id);
        const exist = cart.find(x => x.id === id);
        if(exist) exist.qty++;
        else cart.push({...p, qty: 1});
        saveCart();
        toggleCart();
    }

    function removeFromCart(i) {
        cart.splice(i, 1);
        saveCart();
    }

    function saveCart() {
        localStorage.setItem('urbanCart', JSON.stringify(cart));
        updateCartUI();
    }

    function updateCartUI() {
        const totalQty = cart.reduce((a,b)=>a+b.qty, 0);
        const badge = document.getElementById('navCartCount');
        badge.innerText = totalQty;
        badge.style.display = totalQty > 0 ? 'block' : 'none';

        const list = document.getElementById('cartList');
        list.innerHTML = "";
        let total = 0;
        cart.forEach((item, i) => {
            total += item.price * item.qty;
            list.innerHTML += `
            <div class="cart-item">
                <div>
                    <div>${item.name}</div>
                    <small style="color:#888">₹${item.price} x ${item.qty}</small>
                </div>
                <div style="cursor:pointer; color:red;" onclick="removeFromCart(${i})"><i class="fas fa-trash"></i></div>
            </div>`;
        });
        document.getElementById('cartTotal').innerText = "₹" + total;
    }

    function toggleCart() { document.getElementById('cartDrawer').classList.toggle('open'); }
    
    function checkout() {
        if(cart.length === 0) return alert("Empty Cart");
        let msg = "Hello Urban Crave, Order Details:%0A";
        let total = 0;
        cart.forEach(i => { msg += `- ${i.name} (${i.qty}) = ₹${i.price*i.qty}%0A`; total += i.price*i.qty; });
        msg += `%0A*Total Bill: ₹${total}*`;
        window.open(`https://wa.me/916377390984?text=${msg}`, '_blank');
    }
</script>
</body>
</html>
