<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu | Urban Crave</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --gold: #D4AF37; --bg: #050505; --card: #121212; --text: #eee; }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-top: 80px; }

        /* Navbar */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; position: fixed; top: 0; width: 100%; background: #000; border-bottom: 1px solid #222; z-index: 100; }
        .logo { font-size: 22px; font-weight: 800; }
        .logo span { color: var(--gold); }
        
        .search-bar { flex: 1; max-width: 400px; margin: 0 20px; position: relative; }
        .search-bar input { width: 100%; padding: 10px 40px 10px 15px; border-radius: 20px; border: 1px solid #333; background: #1a1a1a; color: white; outline: none; }
        .search-bar i { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; }

        .cart-icon { position: relative; cursor: pointer; font-size: 22px; }
        .badge { position: absolute; top: -8px; right: -8px; background: var(--gold); color: black; font-size: 10px; padding: 3px 6px; border-radius: 50%; font-weight: bold; }

        /* Layout */
        .container { display: flex; padding: 20px 5%; gap: 30px; }
        
        /* Sidebar Filter */
        .sidebar { width: 200px; display: none; }
        @media(min-width: 768px) { .sidebar { display: block; } }
        .filter-btn { display: block; width: 100%; padding: 10px; text-align: left; background: transparent; border: none; color: #888; cursor: pointer; transition: 0.2s; }
        .filter-btn:hover, .filter-btn.active { color: var(--gold); font-weight: bold; padding-left: 10px; border-left: 2px solid var(--gold); }

        /* Mobile Filter Scroll */
        .mob-filters { display: flex; gap: 10px; overflow-x: auto; padding: 0 5% 15px; margin-bottom: 10px; scrollbar-width: none; }
        @media(min-width: 768px) { .mob-filters { display: none; } }
        .chip { padding: 8px 20px; background: #1a1a1a; border-radius: 30px; font-size: 14px; white-space: nowrap; border: 1px solid #333; }
        .chip.active { background: var(--gold); color: black; border-color: var(--gold); }

        /* Product Grid */
        .main-content { flex: 1; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .card { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #222; display: flex; flex-direction: column; }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .card-body { padding: 15px; display: flex; flex-direction: column; flex: 1; }
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 10px; }
        .add-btn { background: #222; color: var(--gold); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 5px; cursor: pointer; transition: 0.2s; }
        .add-btn:hover { background: var(--gold); color: black; }

        /* Cart Drawer */
        .cart-drawer { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; background: #111; z-index: 1000; border-left: 1px solid #333; padding: 20px; transition: 0.3s; display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.5); }
        .cart-drawer.open { right: 0; }
        .cart-items { flex: 1; overflow-y: auto; margin-top: 20px; }
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .checkout-btn { width: 100%; background: #25D366; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }

    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="logo">URBAN<span>CRAVE.</span></a>
        <div class="search-bar">
            <input type="text" id="searchBox" placeholder="Search pizza, burger..." onkeyup="searchMenu()">
            <i class="fas fa-search"></i>
        </div>
        <div class="cart-icon" onclick="toggleCart()">
            <i class="fas fa-shopping-basket"></i>
            <span class="badge" id="cartCount">0</span>
        </div>
    </nav>

    <div class="mob-filters">
        <div class="chip active" onclick="filter('All', this)">All</div>
        <div class="chip" onclick="filter('Starters', this)">Starters</div>
        <div class="chip" onclick="filter('Main Course', this)">Main Course</div>
        <div class="chip" onclick="filter('Drinks', this)">Drinks</div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h3 style="margin-bottom:20px; color:var(--gold)">Menu</h3>
            <button class="filter-btn active" onclick="filter('All', this)">All Items</button>
            <button class="filter-btn" onclick="filter('Starters', this)">Starters</button>
            <button class="filter-btn" onclick="filter('Main Course', this)">Main Course</button>
            <button class="filter-btn" onclick="filter('Drinks', this)">Drinks</button>
            <button class="filter-btn" onclick="filter('Dessert', this)">Dessert</button>
        </div>

        <div class="main-content">
            <div class="grid" id="grid">Loading Menu...</div>
        </div>
    </div>

    <div class="cart-drawer" id="cartDrawer">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Your Cart</h2>
            <i class="fas fa-times" onclick="toggleCart()" style="cursor:pointer; font-size: 20px;"></i>
        </div>
        <div class="cart-items" id="cartList">Cart is empty</div>
        <div style="border-top:1px solid #333; padding-top:15px;">
            <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:bold; margin-bottom:10px;">
                <span>Total</span>
                <span id="cartTotal">₹0</span>
            </div>
            <button class="checkout-btn" onclick="checkout()"><i class="fab fa-whatsapp"></i> Checkout on WhatsApp</button>
        </div>
    </div>

<script>
    const API_URL = '/.netlify/functions/api';
    let products = [];
    let cart = JSON.parse(localStorage.getItem('urbanCart')) || [];

    // Init
    window.onload = async () => {
        const res = await fetch(API_URL);
        products = await res.json();
        render(products);
        updateCartUI();
    };

    function render(list) {
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        list.forEach(p => {
            grid.innerHTML += `
            <div class="card">
                <img src="${p.image_url}" onerror="this.src='https://via.placeholder.com/200'">
                <div class="card-body">
                    <h4 style="margin-bottom:5px;">${p.name}</h4>
                    <p style="font-size:12px; color:#888; line-height:1.4">${p.description}</p>
                    <div class="price-row">
                        <span style="color:var(--gold); font-weight:bold;">₹${p.price}</span>
                        <button class="add-btn" onclick="addToCart(${p.id})">ADD</button>
                    </div>
                </div>
            </div>`;
        });
    }

    // Filter Logic
    function filter(cat, btn) {
        document.querySelectorAll('.filter-btn, .chip').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        
        if(cat === 'All') render(products);
        else render(products.filter(p => p.category === cat));
    }

    // Search Logic
    function searchMenu() {
        const query = document.getElementById('searchBox').value.toLowerCase();
        const filtered = products.filter(p => p.name.toLowerCase().includes(query));
        render(filtered);
    }

    // Cart Logic
    function addToCart(id) {
        const p = products.find(x => x.id === id);
        const exist = cart.find(x => x.id === id);
        if(exist) exist.qty++;
        else cart.push({...p, qty: 1});
        saveCart();
        toggleCart(); // Open cart on add
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        saveCart();
    }

    function saveCart() {
        localStorage.setItem('urbanCart', JSON.stringify(cart));
        updateCartUI();
    }

    function updateCartUI() {
        document.getElementById('cartCount').innerText = cart.reduce((a,b)=>a+b.qty, 0);
        const list = document.getElementById('cartList');
        list.innerHTML = "";
        let total = 0;

        cart.forEach((item, i) => {
            total += item.price * item.qty;
            list.innerHTML += `
            <div class="cart-item">
                <div>
                    <div>${item.name}</div>
                    <small style="color:#888">₹${item.price} x ${item.qty}</small>
                </div>
                <div style="cursor:pointer; color:red;" onclick="removeFromCart(${i})"><i class="fas fa-trash"></i></div>
            </div>`;
        });

        document.getElementById('cartTotal').innerText = "₹" + total;
    }

    function toggleCart() {
        document.getElementById('cartDrawer').classList.toggle('open');
    }

    function checkout() {
        if(cart.length === 0) return alert("Empty Cart");
        let msg = "Hello Urban Crave, Order Details:%0A";
        let total = 0;
        cart.forEach(i => {
            msg += `- ${i.name} (${i.qty}) = ₹${i.price*i.qty}%0A`;
            total += i.price*i.qty;
        });
        msg += `%0A*Total Bill: ₹${total}*`;
        window.open(`https://wa.me/916377390984?text=${msg}`, '_blank');
    }
</script>
</body>
</html>
